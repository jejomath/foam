enums:
- name: assay_type
  descr: A type of assay.
  options:
  - VITRO - in-vitro | Assays involving cells in plates
  - VIVO - in-vivo | Assays involving animals
  - CILICO - in-cilico | Fake experiments done with code

folders:
- name: plate_map
  descr: Plate map files.
  extensions: ["xlsx", "csv", "tsv"]

table_modules:
- name: experiments
  descr: Tables related to experiments.
  tables:

  - name: assay
    descr: A table with one record for each assay protocol.
    preprocess_new: add_assay_name
    fields:
    - name: name
      type: STRING
      descr: Name of the assay
    - name: type
      type: enum:assay_type
      descr: Type of assay

  - name: experiment
    descr: A table with one record for each experiment.
    preprocess_new: add_experiment_name
    fields:
    - name: name
      type: STRING
      descr: Name of the experiment
    - name: description
      type: TEXT
      descr: A long-form description of the experiment
    - name: start_date
      type: DATE
      descr: The day on which the experiment was started
    - name: assay
      type: ref:assay
      descr: The assay used in the experiment
    - name: plate_map_file
      type: doc:plate_map
      descr: The file that the plate map was loaded from
    - name: type
      type: enum:assay_type
      descr: Type of assay

page_modules:
  - name: experiments
    descr: Pages related to experiments.
    pages:

    - name: home
      descr: Home Page for the whole site
      type: LinksPage
      config:
        boxes:
        - name: assays
          links:
          - target: find_assay
            display: Find Assays
          - target: view_assay
            display: New Assay
        - name: experiments
          links:
          - target: find_experiment
            display: Find Experiments
          - target: edit_experiment
            display: New Experiment
            mode: modal

    - name: view_experiment
      descr: Use this page to find experiments
      type: RecordPage
      config:
        source_table: experiment
        view_fields:
        - name
        - description
        - start_date
        - type
        - assay
        buttons:
        - display: Done
          target: back
        - display: Edit
          target: edit_experiment
          params_fn: "(params) => ({ id: params.id })"

    - name: edit_experiment
      descr: Use this page to find experiments
      type: RecordPage
      config:
        source_table: experiment
        view_fields:
        - name
        - description
        - start_date
        - type
        - assay
        edit_fields:
        - field: name
          display: Experiment Name
        - description
        - start_date
        - type
        - field: assay
          lookup: find_assay
        buttons:
        - display: Save
          target: back
          pretarget_fn: "(params, data, context) => { context.save() }"
        - display: Cancel
          target: back

    - name: find_experiment
      descr: Use this page to find experiments
      type: TablePage
      config:
        source_table: experiment
        view_columns:
        - field: name
          width: 100
        - field: description
          width: 200
        - field: start_date
          width: 50
        - field: type
          width: 150
        search_fields:
        - name
        - description
        - start_date
        - type
        row_action:
          display: Select Experiment
          target: view_experiment
          params_fn: "(data) => ({id: data.id})"
        buttons:
        - display: Done
          target: back

    - name: find_assay
      descr: Use this page to find assays
      type: TablePage
      config:
        source_table: assay
        view_columns:
        - field: name
          width: 100
        - field: type
          width: 150
        search_fields:
        - name
        - type
        row_action:
          display: Select Experiment
          target: view_assay
          params_fn: "(data) => ({id: data.id})"
        buttons:
        - display: Done
          target: back

    - name: view_assay
      descr: View the details of an assay
      type: RecordPage
      config:
        source_table: assay
        view_fields:
        - name
        - type
        reference_tables:
        - display: Experiments
          table_page: find_experiment
          params_fn: "(data) => ({assay: data.id})"
        buttons:
        - display: Done
          target: back
